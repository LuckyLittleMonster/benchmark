./run_nccl_bwl.sh

════════════════════════════════════════════════════════
  NCCL GPU Direct RDMA Performance Test
════════════════════════════════════════════════════════

Communication: NCCL Send/Recv (Point-to-Point)
Test Suite:
  1. Unidirectional Bandwidth (Rank 0 -> Rank 1)
  2. Ping-Pong with 1-byte Ack
  3. Ping-Pong with Same-size Reply

Compiling nccl_bwl.c...
✓ Compilation successful

════════════════════════════════════════════════════════
  Environment Configuration
════════════════════════════════════════════════════════
NCCL Version:    2.24.3
NCCL Plugin:     aws-ofi-nccl (libfabric + CXI)
GPU Direct RDMA: Enabled (GDR Level: PHB)
Network:         Slingshot 11 (CXI)

════════════════════════════════════════════════════════
  Starting Test (2 nodes, 1 task per node)
════════════════════════════════════════════════════════

srun: job 44605804 queued and waiting for resources
srun: job 44605804 has been allocated resources
NCCL version 2.24.3+cuda12.4
=== NCCL GPU Direct RDMA Performance Tests ===
Using NCCL point-to-point communication
Max message size: 10 MB

=== Test 1: Unidirectional (Rank 0 -> Rank 1) ===
size                          latency(us)                   BW(MB/s)                      
1                             16.476621                     0.000069                      
2                             15.691655                     0.000145                      
4                             16.252379                     0.000279                      
8                             15.919000                     0.000570                      
16                            15.043172                     0.001206                      
32                            15.802897                     0.002296                      
64                            16.585793                     0.004376                      
128                           15.634310                     0.009284                      
256                           15.259103                     0.019025                      
512                           15.413172                     0.037669                      
1024                          15.195517                     0.076417                      
2048                          15.545172                     0.149396                      
4096                          16.024724                     0.289850                      
8192                          16.216103                     0.572859                      
16384                         17.041862                     1.090202                      
32768                         24.675897                     1.505848                      
65536                         28.689172                     2.590395                      
131072                        32.990552                     4.505308                      
262144                        37.126793                     8.006756                      
524288                        48.503621                     12.257442                     
1048576                       71.462034                     16.639054                     
2097152                       115.347793                    20.616964                     
4194304                       206.372379                    23.046895                     
8388608                       387.668793                    24.537660                     

=== Test 2: Ping-Pong with 1-byte Ack ===
size                          latency(us)                   BW(MB/s)                      
1                             75.793517                     0.000030                      
2                             75.273207                     0.000045                      
4                             74.764621                     0.000076                      
8                             75.135310                     0.000136                      
16                            74.776379                     0.000258                      
32                            75.311517                     0.000497                      
64                            76.248517                     0.000967                      
128                           74.259172                     0.001970                      
256                           82.792862                     0.003520                      
512                           74.118552                     0.007849                      
1024                          74.202517                     0.015664                      
2048                          74.286103                     0.031278                      
4096                          75.349897                     0.061658                      
8192                          75.334345                     0.123326                      
16384                         76.665517                     0.242354                      
32768                         84.508931                     0.439708                      
65536                         89.961552                     0.826102                      
131072                        95.299069                     1.559655                      
262144                        99.194862                     2.996791                      
524288                        113.605759                    5.233286                      
1048576                       135.205414                    8.794483                      
2097152                       179.574103                    13.243126                     
4194304                       267.565655                    17.775987                     
8388608                       452.605483                    21.017170                     

=== Test 3: Ping-Pong with Same-size Reply ===
size                          latency(us)                   BW(MB/s)                      
1                             37.081207                     0.000031                      
2                             37.962224                     0.000060                      
4                             37.862897                     0.000120                      
8                             37.660948                     0.000241                      
16                            37.016276                     0.000490                      
32                            37.087931                     0.000978                      
64                            37.960155                     0.001912                      
128                           36.647621                     0.003961                      
256                           36.999845                     0.007846                      
512                           37.114724                     0.015643                      
1024                          37.232190                     0.031188                      
2048                          37.143414                     0.062525                      
4096                          37.257241                     0.124668                      
8192                          37.899000                     0.245113                      
16384                         38.768431                     0.479232                      
32768                         46.929017                     0.791795                      
65536                         53.239293                     1.395892                      
131072                        57.945621                     2.565036                      
262144                        62.219724                     4.777668                      
524288                        75.522638                     7.872213                      
1048576                       97.923638                     12.142734                     
2097152                       142.876241                    16.644624                     
4194304                       231.062621                    20.584215                     
8388608                       417.339655                    22.793149                     

=== All Tests Complete ===

════════════════════════════════════════════════════════
  Test Complete
════════════════════════════════════════════════════════

✓ Test completed successfully

Performance Notes:
  - NCCL uses aws-ofi-nccl plugin (libfabric + CXI)
  - GPU Direct RDMA enabled automatically
  - Compare with bwl.c (direct libfabric) and mpi_bwl.c (MPI)

NCCL typically has:
  - Slightly higher latency than direct libfabric (more layers)
  - Similar bandwidth to MPI and libfabric
  - Better collective operations (not tested here)